<!doctype html>
<html lang="en-GB"><head><meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">

	<link rel="icon" type="image/png" href="../favicon.png">

	<title>Ractive.events | Docs | Ractive.js</title>

	
	<link href="http://fonts.googleapis.com/css?family=Source+Code+Pro:400,700,900" rel="stylesheet" type="text/css">
	<link rel="stylesheet" href="../min.css"></head>

<body class="example"><header class="docs-header"><nav><a href="http://ractivejs.org">&laquo; back to ractivejs.org</a>
			<a class="edit-link" href="https://github.com/RactiveJS/docs.ractivejs.org/edit/master/docs/0.3.9/Ractive.events.md"><span>edit this page</span></a></nav>

		<h1>Ractive.events</h1></header>

	<main><div class="breadcrumbs"><a href="ractive-js-documentation">Home</a> &raquo; <a href="api-reference">API Reference</a> &raquo; <a href="ractive-events">Ractive.events</a></div>

<p>If you&#39;re using <a href="Events#on-events">proxy events</a>, you can either use the standard DOM events that an element can listen to (e.g. <code>click</code>, <code>mouseover</code>, <code>touchmove</code>, <code>load</code>, whatever) or you can use custom event definitions.</p>
<p>These allow you to define more complex events than the native ones, but still treat them as first class citizens. For example the <code>tap</code> event abstracts away differences between mouse and touch interfaces, eliminating the 300ms delay users would experience on a touch device if you were only listening for <code>click</code> events:</p>
<pre class="prettyprint lang-html">&lt;a class='button' on-tap='select'&gt;Tap me!&lt;/a&gt;</pre>

<p>You could also use the event definition API to normalise browser behaviour (e.g. with <code>mouseenter</code> and <code>mouseleave</code>, which are handy and widely-used events, but non-standard ones), or to implement swiping and other gestures.</p>
<p>Future versions of Ractive may include more event definitions &#39;out of the box&#39; &ndash; for now, there is just the <code>tap</code> event.</p>
<h2 id="the-event-definition-api">The event definition API</h2>
<p>When Ractive sees a <code>on-[eventName]</code> directive, it first looks in <code>Ractive.eventDefinitions</code> for an <code>[eventName]</code> property, and if it finds one it <em>applies the definition</em>. (If not, it assumes that <code>[eventName]</code> refers to a native DOM event.)</p>
<p>Event definitions receive two arguments &ndash; <code>node</code>, and <code>fire</code>. <code>node</code> is the element to which the definition is being applied, and <code>fire</code> is the function that must be called when the event has taken place.</p>
<h3 id="-fire-when-ready"><code>fire</code> when ready</h3>
<p>The <code>fire</code> function takes a single argument which is the <code>event</code> object received by handlers. It will be augmented with <code>context</code>, <code>keypath</code> and <code>index</code> properties (TODO: explain these).</p>
<p>To be consistent with &#39;native&#39; proxy events, the <code>event</code> object must have a <code>node</code> property (that&#39;s right, you pass the reference back &ndash; this allows us to reuse handlers with many different elements, without penalty), and if applicable an <code>original</code> property which should be an underlying DOM event.</p>
<p>You can add as many other properties as you like, however (swipe start position, long press duration, whether the user is currently standing on their head, whatever you like).</p>
<h3 id="the-event-definition-return-value">The event definition return value</h3>
<p>Event definitions should return an object with a <code>teardown</code> property, which is a function that removes any DOM event handlers that were bound as part of the setup (and undoes any other changes that were applied).</p>
<h3 id="an-example">An example</h3>
<p>All this will make more sense with an example. Let&#39;s define a <code>menu</code> event, which will allow us to insert our own custom menu.</p>
<p>If the user is using a mouse, we want to intercept the <code>contextmenu</code> event (which is generally fired on right-click). On touch devices, we&#39;ll use a long press to signal that the user wants to open the menu, as that is a common interaction within apps.</p>
<pre class="prettyprint lang-js">Ractive.eventDefinitions.menu = function ( node, fire ) {
  var longpressDuration = 500, threshold = 5, contextmenuHandler, touchstartHandler;

  // intercept contextmenu events and suppress them
  contextmenuHandler = function ( event ) {
    event.preventDefault();

    // we'll pass along some coordinates. This will make more sense below
    fire({
      node: node,
      original: event,
      x: event.clientX,
      y: event.clientY
    });
  };

  node.addEventListener( 'contextmenu', contextmenuHandler );

  // that was easy! but touch is a little more complicated
  touchstartHandler = function ( event ) {
    var touches, touch, finger, startX, startY, moveHandler, cancel, timeout;

    // for simplicity, we'll only deal with single finger presses
    if ( event.touches.length !== 1 ) {
      return;
    }

    // suppress the default behaviour
    event.preventDefault();

    // we'll need this info later
    touch = event.touches[0];
    finger = touch.identifier;
    startX = touch.clientX;
    startY = touch.clientY;

    // after the specified delay, fire the event...
    timeout = setTimeout( function () {
      // there is no underlying event we could meaningfully pass on. but
      // we can pass along some coordinates
      fire({
        node: node,
        x: startX,
        y: startY
      });
      cancel();
    }, longpressDuration );

    // ...unless the timeout is cancelled
    cancel = function () {
      clearTimeout( timeout );

      // tidy up after ourselves
      window.removeEventListener( 'touchmove', touchmoveHandler );
      window.removeEventListener( 'touchend', cancel );
      window.removeEventListener( 'touchcancel', cancel );
    };

    // if the user moves their finger, test whether they've moved it beyond a
    // certain threshold or if they've left the target element
    touchmoveHandler = function ( event ) {
      var touch, currentTarget;

      // find the right touch (another finger may have touched the screen)
      i = event.touches.length;
      while ( i-- ) {
        if ( event.touches[i].identifier === finger ) {
          touch = event.touches[i];
          break;
        }
      }

      if ( !touch ) {
        cancel();
        return;
      }

      dx = touch.clientX &ndash; startX;
      dy = touch.clientY &ndash; startY;
      currentTarget = document.elementFromPoint( touch.clientX, touch.clientY );

      // if the finger has moved too far, or is no longer over the target, cancel
      if ( Math.abs( dx ) &gt; threshold || Math.abs( dy ) &gt; threshold || !el.contains( currentTarget ) ) {
        cancel();
      }
    };

    window.addEventListener( 'touchmove', touchmoveHandler );
    window.addEventListener( 'touchend', cancel );
    window.addEventListener( 'touchcancel', cancel );
  };

  node.addEventListener( 'touchstart', touchstartHandler );

  // return an object with a teardown method, so we can unbind everything when the
  // element is removed from the DOM
  return {
    teardown: function () {
      node.removeEventListener( 'contexmenu', contextmenuHandler );
      node.removeEventListener( 'touchstart', touchstartHandler );
    }
  };
};</pre>

<p>You can now use the <code>menu</code> event in Ractive instances:</p>
<pre class="prettyprint lang-html">&lt;div on-menu='showMenu'&gt;This element has its own context menu&lt;/div&gt;</pre>

<pre class="prettyprint lang-js">ractive = new Ractive({
  el: myContainer,
  template: myTemplate
});

ractive.on( 'showMenu', function ( event ) {
  // show menu at client coordinates event.x, event.y
});</pre></main>

	
	<script src="../js/prettify.js"></script>
	<script>prettyPrint();

		// Googlytics
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-5602942-6', 'ractivejs.org');
		ga('send', 'pageview');</script></body></html>